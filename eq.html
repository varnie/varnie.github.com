<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Equilibrium Grid 3x3</title>
<style>
  body {
    background:#0f0f0f;
    color:#eee;
    font-family:system-ui;
    display:flex;
    flex-direction:column;
    align-items:center;
    margin-top:40px;
  }
  h1 { font-weight:300; }
  .grid {
    display:grid;
    grid-template-columns:repeat(3,90px);
    gap:10px;
    margin:20px 0;
  }
  .cell {
    width:90px;
    height:90px;
    background:#1e1e1e;
    border-radius:14px;
    font-size:42px;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    user-select:none;
  }
  .cell:hover {
    background:#2a2a2a;
  }
  button {
    background:#222;
    color:#eee;
    border:1px solid #444;
    padding:10px 18px;
    border-radius:8px;
    cursor:pointer;
  }
</style>
</head>
<body>

<h1>Equilibrium Grid</h1>
<div class="grid" id="grid"></div>
<button onclick="newLevel()">–ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å</button>

<script>
const SIZE = 3;
const TYPES = ["‚ö™","‚¨ú","üî∫"];
let grid = [];

function idx(x,y){ return y*SIZE+x; }

function neighbors(i) {
  const x = i % SIZE;
  const y = Math.floor(i / SIZE);
  const t = grid[i];
  let dirs = [];

  if (t === 0) dirs = [[1,0],[-1,0],[0,1],[0,-1]];
  if (t === 1) dirs = [[1,0],[-1,0]];
  if (t === 2) dirs = [[0,1],[0,-1]];

  return dirs
    .map(([dx,dy])=>[x+dx,y+dy])
    .filter(([nx,ny])=>nx>=0&&ny>=0&&nx<SIZE&&ny<SIZE)
    .map(([nx,ny])=>idx(nx,ny));
}

function applyMove(i) {
  neighbors(i).forEach(n=>{
    grid[n] = (grid[n]+1)%3;
  });
}

function isSolved() {
  return grid.every(v=>v===0);
}

function clickCell(i) {
  applyMove(i);
  render();
  if (isSolved()) {
    setTimeout(()=>alert("–†–∞–≤–Ω–æ–≤–µ—Å–∏–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ"),50);
  }
}

function render() {
  const g = document.getElementById("grid");
  g.innerHTML="";
  grid.forEach((v,i)=>{
    const d=document.createElement("div");
    d.className="cell";
    d.textContent=TYPES[v];
    d.onclick=()=>clickCell(i);
    g.appendChild(d);
  });
}

function newLevel() {
  grid = Array(SIZE*SIZE).fill(0);
  const moves = 6;
  for (let k=0;k<moves;k++) {
    const r = Math.floor(Math.random()*grid.length);
    applyMove(r);
  }
  render();
}

newLevel();
</script>
</body>
</html>
