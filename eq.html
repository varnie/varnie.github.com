<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Equilibrium Grid</title>

<style>
:root {
  --cell-size: clamp(72px, 22vmin, 120px);
  --gap: clamp(8px, 3vmin, 16px);
  --font-size: clamp(36px, 10vmin, 56px);
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  background: #0e0e0e;
  color: #eee;
  font-family: system-ui, sans-serif;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

.app {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
}

h1 {
  font-weight: 300;
  margin: 0;
  opacity: 0.9;
}

.grid {
  display: grid;
  grid-template-columns: repeat(3, var(--cell-size));
  gap: var(--gap);
}

.cell {
  width: var(--cell-size);
  height: var(--cell-size);
  background: #1e1e1e;
  border-radius: 20%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--font-size);
  user-select: none;
  cursor: pointer;
  touch-action: manipulation;
  transition: background 0.15s ease;
}

/* hover —Ç–æ–ª—å–∫–æ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å –º—ã—à—å—é */
@media (hover: hover) {
  .cell:hover {
    background: #2a2a2a;
  }
}

.cell:active {
  background: #333;
}

button {
  background: #222;
  color: #eee;
  border: 1px solid #444;
  padding: 12px 24px;
  border-radius: 10px;
  font-size: 16px;
  cursor: pointer;
}

button:active {
  background: #333;
}
</style>
</head>

<body>
<div class="app">
  <h1>Equilibrium</h1>
  <div class="grid" id="grid"></div>
  <button onclick="newLevel()">–ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å</button>
</div>

<script>
const SIZE = 3;
const TYPES = ["‚ö™", "‚¨ú", "üî∫"];
let grid = [];

function neighbors(i) {
  const x = i % SIZE;
  const y = Math.floor(i / SIZE);
  const t = grid[i];
  let dirs = [];

  if (t === 0) dirs = [[1,0],[-1,0],[0,1],[0,-1]];
  if (t === 1) dirs = [[1,0],[-1,0]];
  if (t === 2) dirs = [[0,1],[0,-1]];

  return dirs
    .map(([dx,dy]) => [x+dx, y+dy])
    .filter(([nx,ny]) => nx>=0 && ny>=0 && nx<SIZE && ny<SIZE)
    .map(([nx,ny]) => ny*SIZE + nx);
}

function applyMove(i) {
  neighbors(i).forEach(n => {
    grid[n] = (grid[n] + 1) % 3;
  });
}

function isSolved() {
  return grid.every(v => v === 0);
}

function clickCell(i) {
  applyMove(i);
  render();
  if (isSolved()) {
    setTimeout(() => alert("–†–∞–≤–Ω–æ–≤–µ—Å–∏–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ üßò"), 50);
  }
}

function render() {
  const g = document.getElementById("grid");
  g.innerHTML = "";
  grid.forEach((v,i) => {
    const d = document.createElement("div");
    d.className = "cell";
    d.textContent = TYPES[v];
    d.onclick = () => clickCell(i);
    g.appendChild(d);
  });
}

function newLevel() {
  grid = Array(SIZE*SIZE).fill(0);
  for (let k = 0; k < 6; k++) {
    applyMove(Math.floor(Math.random() * grid.length));
  }
  render();
}

newLevel();
</script>
</body>
</html>
